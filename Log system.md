Для создания системы логирования в клиент-серверной системе с возможностью восстановления сети после сбоя главного узла, можно использовать централизованный подход с сохранением логов в базе данных. Это позволит всем узлам иметь доступ к последней информации о состоянии системы и выполнять восстановление. Вот рекомендации по реализации:

### 1. Структура логов
Логи должны фиксировать ключевые события системы, включая:
   - **Время события** — время в UTC, чтобы избежать проблем с временными зонами.
   - **Идентификатор узла** — уникальный идентификатор, который помог бы отслеживать, какой узел инициировал действие.
   - **Тип действия** — тип лога, например, `соединение`, `разрыв соединения`, `ошибка`, `обновление данных`.
   - **Описание действия** — детализация действия (например, какой процесс запущен или завершен, какие данные обновлены).
   - **Статус** — результат выполнения действия (успех, ошибка).

### 2. Лексемы для логов
Лексемы помогут стандартизировать сообщения и сделать их удобными для анализа. Вот несколько ключевых типов лексем:
   - `NODE_CONNECT` — узел установил соединение.
   - `NODE_DISCONNECT` — узел разорвал соединение.
   - `DATA_UPDATE` — обновление данных в БД.
   - `TASK_COMPLETION` — завершение выполнения задачи.
   - `ERROR` — ошибка при выполнении операции, требуется детализированное описание ошибки.
   - `RECOVERY` — действие восстановления сети или узла после сбоя.

### 3. Формат логов
Можно использовать JSON или текстовые строки с четким разделением полей, например:
```json
{
    "timestamp": "2024-11-08T12:34:56Z",
    "node_id": "Node-01",
    "action_type": "NODE_CONNECT",
    "description": "Node connected to the main server.",
    "status": "success"
}
```

### 4. Выбор системы хранения логов
Поскольку у вас есть централизованная база данных с доступом у всех узлов, логи можно хранить в отдельной таблице. Структура таблицы может выглядеть так:
   - **log_id** — уникальный идентификатор лога.
   - **timestamp** — дата и время события.
   - **node_id** — идентификатор узла.
   - **action_type** — тип действия (лексемы).
   - **description** — текстовое описание действия.
   - **status** — статус выполнения.

Пример создания таблицы в SQL:
```sql
CREATE TABLE logs (
    log_id SERIAL PRIMARY KEY,
    timestamp TIMESTAMP NOT NULL,
    node_id VARCHAR(50) NOT NULL,
    action_type VARCHAR(50) NOT NULL,
    description TEXT,
    status VARCHAR(20)
);
```

### 5. Автоматическое восстановление узла
Чтобы новый узел смог восстановить сеть после сбоя главного узла, можно:
   - Хранить логи о последних активностях и состоянии соединений.
   - Считывать логи при восстановлении и использовать информацию для инициализации или повторного подключения узлов.

### 6. Реализация логирования
Каждый узел может отправлять логи в базу данных с помощью REST API или напрямую через запросы к БД. Например, при каждом важном событии узел отправляет лог в формате JSON с использованием POST-запроса к API.

### 7. Обработка ошибок
   - При сбое записи лога (например, недоступность базы данных) логи можно временно сохранять локально на узле и отправлять их при восстановлении связи с БД.

### 8. Мониторинг логов
Добавьте возможность анализа логов для быстрого поиска ошибок и создания автоматических уведомлений при определенных типах ошибок или событиях.

Этот подход позволит обеспечить надёжное логирование и облегчить восстановление системы в случае сбоя, поскольку вся необходимая информация о состоянии сети будет централизованно доступна.